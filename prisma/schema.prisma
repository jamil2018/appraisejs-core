generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TestSuite {
  id          String   @id @default(uuid())
  name        String
  description String?
  moduleId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  module    Module     @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  testCases TestCase[] @relation("TestSuiteTestCases")
}

model Review {
  id         String       @id @default(uuid())
  testCaseId String
  reviewerId String // Keep as string for now, but won't reference User
  status     ReviewStatus
  comments   String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  testCase   TestCase     @relation(fields: [testCaseId], references: [id])
}

model LinkedJiraTicket {
  id            String   @id @default(uuid())
  testCaseId    String
  jiraTicketId  String
  jiraTicketUrl String
  jiraStatus    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  testCase      TestCase @relation(fields: [testCaseId], references: [id])
}

model TemplateStep {
  id                 String                  @id @default(uuid())
  name               String
  description        String?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  signature          String
  functionDefinition String?
  type               TemplateStepType
  icon               TemplateStepIcon
  parameters         TemplateStepParameter[]
  TestCaseStep       TestCaseStep[]

  TemplateTestCaseStep TemplateTestCaseStep[]
}

model TemplateStepParameter {
  id             String            @id @default(uuid())
  name           String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  templateStepId String
  order          Int
  type           StepParameterType
  templateStep   TemplateStep      @relation(fields: [templateStepId], references: [id])
}

model TestCase {
  id                String             @id @default(uuid())
  title             String
  description       String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  linkedJiraTickets LinkedJiraTicket[]
  reviews           Review[]
  steps             TestCaseStep[]

  TestSuite TestSuite[] @relation("TestSuiteTestCases")
}

model TestCaseStep {
  id             String                  @id @default(uuid())
  testCaseId     String
  order          Int
  gherkinStep    String
  icon           TemplateStepIcon
  label          String
  testCase       TestCase                @relation(fields: [testCaseId], references: [id])
  parameters     TestCaseStepParameter[]
  templateStepId String
  TemplateStep   TemplateStep            @relation(fields: [templateStepId], references: [id])
}

model TemplateTestCase {
  id          String                 @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  steps       TemplateTestCaseStep[]
}

model TemplateTestCaseStep {
  id                 String                          @id @default(uuid())
  order              Int
  gherkinStep        String
  icon               TemplateStepIcon
  label              String
  templateTestCaseId String
  templateTestCase   TemplateTestCase                @relation(fields: [templateTestCaseId], references: [id])
  parameters         TemplateTestCaseStepParameter[]
  templateStepId     String
  TemplateStep       TemplateStep                    @relation(fields: [templateStepId], references: [id])
}

model TemplateTestCaseStepParameter {
  id                   String               @id @default(uuid())
  name                 String
  defaultValue         String
  order                Int
  testCaseStepId       String
  locatorId            String?
  type                 StepParameterType
  defaultLocatorId     String?
  defaultLocator       Locator?             @relation(fields: [defaultLocatorId], references: [id])
  templateTestCaseStep TemplateTestCaseStep @relation(fields: [testCaseStepId], references: [id])
}

model TestCaseStepParameter {
  id             String            @id @default(uuid())
  name           String
  value          String
  order          Int
  testCaseStepId String
  locatorId      String?
  type           StepParameterType
  Locator        Locator?          @relation(fields: [locatorId], references: [id])
  testCaseStep   TestCaseStep      @relation(fields: [testCaseStepId], references: [id])
}

model Locator {
  id                            String                          @id @default(uuid())
  name                          String
  value                         String
  moduleId                      String
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime                        @updatedAt
  module                        Module                          @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  stepParameters                TestCaseStepParameter[]
  TemplateTestCaseStepParameter TemplateTestCaseStepParameter[]
}

model Module {
  id         String      @id @default(uuid())
  name       String
  parentId   String?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  parent     Module?     @relation("ModuleHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children   Module[]    @relation("ModuleHierarchy")
  testSuites TestSuite[]
  locators   Locator[]
}

enum Role {
  ADMIN
  TESTER
  REVIEWER
}

enum ReviewStatus {
  PENDING
  APPROVED
  CHANGES_REQUESTED
}

enum TestCaseStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum TestCaseResult {
  PASSED
  FAILED
  BLOCKED
  SKIPPED
  RETEST
  UNTESTED
}

enum TemplateStepType {
  ACTION
  ASSERTION
  FLOW_CONTROL
}

enum StepParameterType {
  NUMBER
  STRING
  DATE
  BOOLEAN
  LOCATOR
}

enum StepParameterValueType {
  STRING
  NUMBER
  LOCATOR
}

enum TemplateStepIcon {
  MOUSE
  NAVIGATION
  INPUT
  DOWNLOAD
  API
  STORE
  FORMAT
  DATA
  UPLOAD
  WAIT
  VALIDATION
  DEBUG
}
