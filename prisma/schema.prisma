generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String      @id @default(uuid())
  username       String      @unique
  email          String      @unique
  password       String
  role           Role
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  createdReviews Review[]    @relation("ReviewCreator")
  reviews        Review[]    @relation("Reviewer")
  testCases      TestCase[]  @relation("TestCaseCreator")
  testRuns       TestRun[]   @relation("TestRunExecutor")
  TestSuite      TestSuite[]
  UserRole       UserRole[]
}

model TestSuite {
  id          String     @id @default(uuid())
  name        String
  description String?
  createdBy   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  testRuns    TestRun[]
  creator     User       @relation(fields: [createdBy], references: [id])
  testCases   TestCase[] @relation("TestSuiteTestCases")
}

model Review {
  id         String       @id @default(uuid())
  testCaseId String
  reviewerId String
  status     ReviewStatus
  comments   String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  createdBy  String
  creator    User         @relation("ReviewCreator", fields: [createdBy], references: [id])
  reviewer   User         @relation("Reviewer", fields: [reviewerId], references: [id])
  testCase   TestCase     @relation(fields: [testCaseId], references: [id])
}

model LinkedJiraTicket {
  id            String   @id @default(uuid())
  testCaseId    String
  jiraTicketId  String
  jiraTicketUrl String
  jiraStatus    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  testCase      TestCase @relation(fields: [testCaseId], references: [id])
}

model TestRun {
  id            String            @id @default(uuid())
  testSuiteId   String
  executedBy    String
  status        TestRunStatus
  executionTime String?
  comments      String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  name          String
  executor      User              @relation("TestRunExecutor", fields: [executedBy], references: [id])
  testSuite     TestSuite         @relation(fields: [testSuiteId], references: [id])
  testCases     TestRunTestCase[]
}

model TestRunTestCase {
  testRunId     String
  testCaseId    String
  executionTime Int?
  comments      String?
  status        TestCaseStatus
  result        TestCaseResult?
  testCase      TestCase        @relation(fields: [testCaseId], references: [id])
  testRun       TestRun         @relation(fields: [testRunId], references: [id])

  @@id([testRunId, testCaseId])
}

model UserRole {
  id        String   @id @default(uuid())
  userId    String
  role      Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model TemplateStep {
  id                 String                  @id @default(uuid())
  name               String
  description        String?
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  signature          String
  functionDefinition String?
  type               TemplateStepType
  icon               TemplateStepIcon
  parameters         TemplateStepParameter[]
}

model TemplateStepParameter {
  id             String            @id @default(uuid())
  name           String
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  templateStepId String
  order          Int
  type           StepParameterType
  templateStep   TemplateStep      @relation(fields: [templateStepId], references: [id])
}

model TestCase {
  id                String             @id @default(uuid())
  title             String
  description       String
  createdBy         String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  linkedJiraTickets LinkedJiraTicket[]
  reviews           Review[]
  creator           User               @relation("TestCaseCreator", fields: [createdBy], references: [id])
  steps             TestCaseStep[]
  testRuns          TestRunTestCase[]
  TestSuite         TestSuite[]        @relation("TestSuiteTestCases")
}

model TestCaseStep {
  id          String                  @id @default(uuid())
  testCaseId  String
  order       Int
  gherkinStep String
  icon        TemplateStepIcon
  label       String
  testCase    TestCase                @relation(fields: [testCaseId], references: [id])
  parameters  TestCaseStepParameter[]
}

model TestCaseStepParameter {
  id             String            @id @default(uuid())
  name           String
  value          String
  order          Int
  testCaseStepId String
  locatorId      String?
  type           StepParameterType
  Locator        Locator?          @relation(fields: [locatorId], references: [id])
  testCaseStep   TestCaseStep      @relation(fields: [testCaseStepId], references: [id])
}

model Locator {
  id             String                  @id @default(uuid())
  name           String
  value          String
  createdAt      DateTime                @default(now())
  updatedAt      DateTime                @updatedAt
  stepParameters TestCaseStepParameter[]
}

enum Role {
  ADMIN
  TESTER
  REVIEWER
}

enum ReviewStatus {
  PENDING
  APPROVED
  CHANGES_REQUESTED
}

enum TestRunStatus {
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum TestCaseStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum TestCaseResult {
  PASSED
  FAILED
  BLOCKED
  SKIPPED
  RETEST
  UNTESTED
}

enum TemplateStepType {
  ACTION
  ASSERTION
  FLOW_CONTROL
}

enum StepParameterType {
  NUMBER
  STRING
  DATE
  BOOLEAN
  LOCATOR
}

enum StepParameterValueType {
  STRING
  NUMBER
  LOCATOR
}

enum TemplateStepIcon {
  MOUSE
  NAVIGATION
  INPUT
  DOWNLOAD
  API
  STORE
  FORMAT
  DATA
  UPLOAD
  WAIT
  VALIDATION
  DEBUG
}
